image: gitpod/workspace-android

tasks:
  - name: setup-android-environment
    init: |
      # ÂÆâË£ÖJava 17
      sdk install java 17.0.9-zulu
      sdk use java 17.0.9-zulu
      sdk default java 17.0.9-zulu
      
      # ËÆæÁΩÆAndroid SDK
      export ANDROID_HOME=~/android-sdk
      export ANDROID_SDK_ROOT=~/android-sdk
      mkdir -p ~/android-sdk
      cd ~/android-sdk
      
      # ‰∏ãËΩΩAndroidÂëΩ‰ª§Ë°åÂ∑•ÂÖ∑
      wget -q https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip
      unzip -q commandlinetools-linux-9477386_latest.zip
      mkdir -p cmdline-tools/latest
      mv cmdline-tools/* cmdline-tools/latest/ 2>/dev/null || true
      
      # ËÆæÁΩÆPATH
      export PATH=$PATH:$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools:$ANDROID_HOME/emulator
      
      # ÂÆâË£ÖÂøÖË¶ÅÁªÑ‰ª∂
      yes | sdkmanager --licenses > /dev/null 2>&1
      sdkmanager "platform-tools" "platforms;android-34" "build-tools;34.0.0"
      
      # ÂàõÂª∫local.properties
      echo "sdk.dir=$ANDROID_HOME" > /workspace/CameraX/local.properties
      
      echo "Android development environment setup complete!"
      
  - name: setup-web-emulator
    command: |
      echo "Setting up web-based Android emulator..."
      chmod +x setup_web_android.sh
      ./setup_web_android.sh
      
  - name: build-project
    command: |
      # Á°Æ‰øùÁéØÂ¢ÉÂèòÈáèÊ≠£Á°ÆËÆæÁΩÆ
      export ANDROID_HOME=~/android-sdk
      export ANDROID_SDK_ROOT=~/android-sdk
      export PATH=$PATH:$ANDROID_HOME/cmdline-tools/latest/bin:$ANDROID_HOME/platform-tools
      
      echo "Building Android project..."
      ./gradlew clean assembleDebug
      
      echo "Waiting for emulator..."
      adb wait-for-device
      
      echo "Installing APK..."
      adb install app/build/outputs/apk/debug/app-debug.apk
      
      echo "Starting app..."
      adb shell am start -n com.example.cameraapp/.MainActivity
      
      echo "‚úÖ App installed and started!"
      echo "üåê View in browser at port 6080"

ports:
  - port: 5900
    onOpen: ignore
    description: VNC Server
  - port: 6080
    onOpen: open-browser
    description: Web VNC Client (noVNC)
  - port: 5037
    onOpen: ignore
    description: ADB Server

vscode:
  extensions:
    - ms-vscode.vscode-kotlin
    - vscjava.vscode-java-pack

ports:
  - port: 3000
    onOpen: ignore

vscode:
  extensions:
    - ms-vscode.vscode-kotlin
    - vscjava.vscode-java-pack